{% extends 'base-admin.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block contents %}
    {% block breadcome %}

    {% endblock %}
    <div class="library-book-area mg-t-30">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="single-cards-item">
                        <div class="single-product-image">
                            <a href="#"><img src="{% static 'img/bg-top.jpg' %}" alt=""></a>
                        </div>
                        <div class="single-product-text">
                            <img src="{{ user_obj.image.url }}" alt="">
                            <h4><a class="cards-hd-dn" href="#">{{ user_obj|title }}</a></h4>
                            <h5>{{ user_obj.get_user_type_display }}</h5>
                            <p class="ctn-cards">Department: {{ user_obj.get_department_display }}</p>
                            <hr>
                            <div class="row">
                                <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                    <div class="cards">
                                        <p><b>Email:</b> {{ user_obj.email }}</p>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                    <div class="cards">
                                        <p><b>Phone:</b> {{ user_obj.mobile_number }}</p>
                                    </div>
                                </div>
                                {% if user_obj.date_of_birth %}
                                    <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                        <div class="cards">
                                            <p><b>Date of Birth:</b> {{ user_obj.date_of_birth }}</p>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if user_obj.address %}
                                    <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                        <div class="cards">
                                            <p><b>Address:</b> {{ user_obj.address }}<br>
                                                {{ user_obj.place|default_if_none:"" }}, {{ user_obj.pin_code|default_if_none:"" }}
                                            </p>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if user_obj.user_type == 'teacher' or user_obj.user_type == 'hod' or user_obj.user_type == 'trainer' %}
                                    {% if user_obj.get_profile.experience %}
                                        <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                            <div class="cards">
                                                <p><b>Experience:</b> {{ user_obj.get_profile.experience }}</p>
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% if user_obj.get_profile.qualification %}
                                        <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4">
                                            <div class="cards">
                                                <p><b>Qualification:</b> {{ user_obj.get_profile.qualification }}</p>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                                {% if user_obj %}

                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if user_obj.user_type == 'student' or user_obj.user_type == 'trainee' %}
                <br>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="product-status-wrap drp-lst">
                            <h4>Exam Results</h4>
                            <div class="asset-inner">
                                <table>
                                    <tr>
                                        <th>Exam</th>
                                        <th>Name</th>
                                        <th>Mark</th>
                                    </tr>
                                    {% for student in user_obj.get_profile.my_exam_results %}
                                        <tr>
                                            <td width="30%">{{ student.exam }}</td>
                                            <td width="30%">{{ student.attended_by }}</td>
                                            <td>
                                                {% if student.mark %}
                                                    {{ student.mark }}/ {{ exam.max_score }}
                                                {% else %}
                                                    Check after {{ student.exam.date|date:" d, M Y" }} after
                                                    {{ student.exam.time }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if user_obj.user_type == 'teacher' or user_obj.user_type == 'trainer' %}
                {% if user_obj != user %}
                    <br>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="product-status-wrap drp-lst">
                                <h4>Exams Conducted</h4>
                                <div class="asset-inner">
                                    <table>
                                        <tr>
                                            {% if user.user_type == 'teacher' %}
                                                <th>Subject</th>
                                            {% endif %}
                                            {% if user.user_type == 'trainer' %}
                                                <th>Course</th>
                                            {% endif %}
                                            <th>Max Score</th>
                                            <th>Max Time</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Action</th>
                                        </tr>
                                        {% for item in user_obj.get_profile.my_exams %}
                                            <tr>
                                                {% if user.user_type == 'teacher' %}
                                                    <td>{{ item.subject }}</td>
                                                {% endif %}
                                                {% if user.user_type == 'trainer' %}
                                                    <td>{{ item.course }}</td>
                                                {% endif %}
                                                <td>{{ item.max_score }} Marks</td>
                                                <td>{{ item.max_time }} Minutes</td>
                                                <td>{{ item.date|date }}</td>
                                                <td>{{ item.time|time }}</td>
                                                <td><a href="{% url 'exam-mark-list'  item.id %}"
                                                       class="btn btn-primary">Mark List</a></td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            {% if user.is_superuser or user_obj == user %}
                {% if user_obj.user_type == 'teacher' or user_obj.user_type == 'hod' or user_obj.user_type == 'trainer' %}
                    <br>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="product-status-wrap drp-lst">
                                <h4>Salary History</h4>
                                {% if user.is_superuser %}
                                    <div class="add-product">
                                        <a type="button" class="btn btn-primary" data-toggle="modal"
                                           data-target="#salaryModal">Add Salary</a>
                                    </div>
                                {% endif %}
                                <div class="modal fade" id="salaryModal" role="dialog">
                                    <div class="modal-dialog">
                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">&times;
                                                </button>
                                                <h4 class="modal-title">Add Salary</h4>
                                            </div>
                                            <div class="modal-body">
                                                <form action="{% url 'add-salary-view' user_obj.id %}"
                                                      method="post" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                    {% if form.non_field_errors %}
                                                        <div class="alert alert-danger" role="alert">
                                                            {% for error in form.non_field_errors %}
                                                                {{ error }}
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                    <div class="form-row">
                                                        {{ salary_form|crispy }}
                                                        <div>
                                                            <button type="submit" class="btn btn-primary">Submit
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="asset-inner">
                                    <table class="table table-bordered">
                                        <tr>
                                            <th>Month</th>
                                            <th>Amount</th>
                                            <th>Pending</th>
                                            <th>Status</th>
                                        </tr>
                                        {% for salary in user_obj.salary_history %}
                                            <tr>
                                                <td>{{ salary.get_month_display }}</td>
                                                <td>{{ salary.amount }}</td>
                                                <td>{{ salary.pending }}</td>
                                                <td>{{ salary.status }}</td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if user_obj.user_type == 'student' or user_obj.user_type == 'trainee' %}
                    <br>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="product-status-wrap drp-lst">
                                <h4>Fee Payment History</h4>
                                {% if user.is_superuser %}
                                    <div class="add-product">
                                        <a type="button" class="btn btn-primary" data-toggle="modal"
                                           data-target="#feeModal">Add Fee </a>
                                    </div>
                                {% endif %}
                                <div class="modal fade" id="feeModal" role="dialog">
                                    <div class="modal-dialog">
                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">&times;
                                                </button>
                                                <h4 class="modal-title">Add Fee</h4>
                                            </div>
                                            <div class="modal-body">
                                                <form action="{% url 'add-fee-view' user_obj.id %}"
                                                      method="post" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                    {% if form.non_field_errors %}
                                                        <div class="alert alert-danger" role="alert">
                                                            {% for error in form.non_field_errors %}
                                                                {{ error }}
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                    <div class="form-row">
                                                        {{ fee_form|crispy }}
                                                        <div>
                                                            <button type="submit" class="btn btn-primary">Submit
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="asset-inner">
                                    <table class="table table-bordered">
                                        <tr>
                                            <th>Fee Type</th>
                                            <th>Amount</th>
                                            <th>Due</th>
                                            <th>Status</th>
                                        </tr>
                                        {% for fee in user_obj.fee_history %}
                                            <tr>
                                                <td>{{ fee.get_fee_type_display }}</td>
                                                <td>{{ fee.amount }}</td>
                                                <td>{{ fee.due }}</td>
                                                <td>{{ fee.status }}</td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
{% endblock %}